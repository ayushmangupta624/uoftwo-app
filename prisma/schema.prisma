// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}


enum Ethnicity {
  ASIAN
  BLACK
  HISPANIC
  WHITE
  NATIVE
  MIDDLE_EASTERN
  OTHER
}

enum Genres {
  pop
  rock
  metal
  hiphop
  blues
  latin
  bollywood
}

enum Hobbies {
  // Music & Performance
  playing_music
  singing
  djing
  music_production
  dancing
  ballet
  theater
  stand_up_comedy
  
  // Sports & Fitness
  running
  basketball
  baseball
  soccer
  football
  tennis
  volleyball
  swimming
  surfing
  skiing
  snowboarding
  skateboarding
  rock_climbing
  bouldering
  cycling
  yoga
  pilates
  martial_arts
  boxing
  weightlifting
  crossfit
  hiking
  camping
  
  // Games & Strategy
  chess
  board_games
  card_games
  video_games
  esports
  poker
  puzzles
  escape_rooms
  
  // Creative Arts
  painting
  drawing
  sculpting
  pottery
  photography
  videography
  graphic_design
  fashion_design
  interior_design
  writing
  poetry
  calligraphy
  knitting
  crocheting
  sewing
  woodworking
  metalworking
  jewelry_making
  
  // Technology
  coding
  web_development
  app_development
  game_development
  robotics
  threed_printing
  electronics
  hacking
  
  // Food & Drink
  cooking
  baking
  mixology
  wine_tasting
  coffee_roasting
  
  // Nature & Animals
  gardening
  birdwatching
  fishing
  hunting
  horseback_riding
  pet_care
  
  // Learning & Culture
  reading
  book_clubs
  learning_languages
  traveling
  museums
  astronomy
  history
  philosophy
  meditation
  
  // Social & Community
  volunteering
  activism
  debating
  public_speaking
  networking
  mentoring
  
  // Collection & Hobbies
  collecting
  thrifting
  vintage_shopping
  antiques
  coin_collecting
  stamp_collecting
  
  // Other
  magic_tricks
  juggling
  origami
  model_building
  drones
  podcasting
  blogging
  vlogging
  streaming
  cosplay
  anime
  comics
  cars
  motorcycles
}

model User {
  id               String      @id @default(uuid()) @db.Uuid
  userId           String      @unique @map("user_id") @db.Uuid
  email            String?     @db.Text
  gender           String      @db.Text
  genderPreference String[]    @default([]) @map("gender_preference") @db.Text
  fname            String      @db.Text
  lname            String      @db.Text
  areas_of_study   String[]
  ethnicity        Ethnicity
  dateOfBirth      DateTime?   @map("date_of_birth") @db.Date
  yearOfStudy      Int?        @map("year_of_study")
  images           String[]    @default([]) @db.Text
  createdAt        DateTime    @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime    @updatedAt @map("updated_at") @db.Timestamptz(6)
  description      String      @default("null") @db.Text
  campus           String      @default("null") @db.Text
  aiSummary        String?     @map("ai_summary") @db.Text
  musicGenres      Genres[]    @default([])
  lookingFor       String      @default("null") @db.Text
    
  // Questionnaire fields
  hobbies          Hobbies[]
  favoriteBands    String[]    @default([]) @map("favorite_bands") @db.Text
  sportsTeams      String[]    @default([]) @map("sports_teams") @db.Text
  footballPreference String?   @map("football_preference") @db.Text
  clubs            String[]    @default([]) @db.Text
  studyPreference  String?     @map("study_preference") @db.Text
  favCampusSpots   String[]    @default([]) @map("fav_campus_spots") @db.Text
  personalityTraits String[]   @default([]) @map("personality_traits") @db.Text
  values           String[]    @default([]) @db.Text
  goingOutFrequency String?    @map("going_out_frequency") @db.Text
  idealWeekend     String?     @map("ideal_weekend") @db.Text
  aboutMe          String?     @map("about_me") @db.Text
  dealBreakers     String[]    @default([]) @map("deal_breakers") @db.Text

  // AI-generated personality features (10 features extracted from questionnaire)
  features         Json        @default("[]") // Array of {name: string, score: number}
  featureEmbedding String[]    @default([]) @map("feature_embedding") @db.Text // 768-dim semantic embedding

  // Schedule and feedback relations
  schedule         Schedule?
  profileViews     ProfileView[]   @relation("ProfileViewer")
  viewedBy         ProfileView[]   @relation("ProfileViewed")

  // relations to join table for likes
  likedUsers       UserLike[]  @relation("LikedUsers")   // the rows where this user liked someone
  likedByUsers     UserLike[]  @relation("LikedByUsers") // the rows where this user was liked

  //relations to join table for 
  passesMade       UserPass[]  @relation("PassesMade")
  
  // messaging relations
  conversationsAsUser1  Conversation[] @relation("User1Conversations")
  conversationsAsUser2  Conversation[] @relation("User2Conversations")
  sentMessages          Message[]       @relation("MessageSender")
  messageReactions      MessageReaction[] @relation("UserReactions")
  sentReplies           MessageReply[]    @relation("MessageReplySender")

  @@map("users")
}

model UserLike {
  id        String   @id @default(uuid()) @db.Uuid
  likerId   String   @db.Uuid
  likedId   String   @db.Uuid
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  // relations back to User
  liker     User @relation("LikedUsers", fields: [likerId], references: [userId], onDelete: Cascade)
  liked     User @relation("LikedByUsers", fields: [likedId], references: [userId], onDelete: Cascade)

  @@unique([likerId, likedId], name: "likerId_likedId")
  @@map("user_likes")
}

model UserPass {
  id        String   @id @default(uuid()) @db.Uuid
  passerId  String   @db.Uuid
  passedId  String   @db.Uuid
  createdAt DateTime @default(now())

  passer    User     @relation("PassesMade", fields: [passerId], references: [userId], onDelete: Cascade)
  @@unique([passerId, passedId], name: "passerId_passedId")
  @@map("user_passes")
}

model Conversation {
  id        String    @id @default(uuid()) @db.Uuid
  user1Id   String    @map("user1_id") @db.Uuid
  user2Id   String    @map("user2_id") @db.Uuid
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)

  user1     User      @relation("User1Conversations", fields: [user1Id], references: [userId], onDelete: Cascade)
  user2     User      @relation("User2Conversations", fields: [user2Id], references: [userId], onDelete: Cascade)
  messages  Message[]

  @@unique([user1Id, user2Id], name: "user1Id_user2Id")
  @@map("conversations")
}

model Message {
  id             String          @id @default(uuid()) @db.Uuid
  conversationId String          @map("conversation_id") @db.Uuid
  senderId       String          @map("sender_id") @db.Uuid
  content        String          @db.Text
  createdAt      DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime        @updatedAt @map("updated_at") @db.Timestamptz(6)

  conversation   Conversation    @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User            @relation("MessageSender", fields: [senderId], references: [userId], onDelete: Cascade)
  reactions      MessageReaction[]
  replies        MessageReply[]

  @@map("messages")
}

model MessageReaction {
  id        String   @id @default(uuid()) @db.Uuid
  messageId String   @map("message_id") @db.Uuid
  userId    String   @map("user_id") @db.Uuid
  emoji     String   @db.Text
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User     @relation("UserReactions", fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([messageId, userId, emoji], name: "message_user_emoji")
  @@map("message_reactions")
}

model MessageReply {
  id        String   @id @default(uuid()) @db.Uuid
  messageId String   @map("message_id") @db.Uuid
  senderId  String   @map("sender_id") @db.Uuid
  content   String   @db.Text
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  sender    User     @relation("MessageReplySender", fields: [senderId], references: [userId], onDelete: Cascade)

  @@map("message_replies")
}

model Schedule {
  id          String   @id @default(uuid()) @db.Uuid
  userId      String   @unique @map("user_id") @db.Uuid
  pdfUrl      String?  @map("pdf_url") @db.Text
  courses     Json     @default("[]") // Array of ParsedCourse objects
  buildings   String[] @default([]) // Extracted building codes
  timeSlots   Json     @default("[]") // Structured time slot data
  parsedAt    DateTime @default(now()) @map("parsed_at") @db.Timestamptz(6)
  updatedAt   DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  user        User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@map("schedules")
}

model ProfileView {
  id              String   @id @default(uuid()) @db.Uuid
  viewerId        String   @map("viewer_id") @db.Uuid
  viewedProfileId String   @map("viewed_profile_id") @db.Uuid
  duration        Int      @default(0) // in seconds
  scrollDepth     Float    @default(0.0) // 0.0 to 1.0
  interacted      Boolean  @default(false) // liked or passed
  interactionType String?  @map("interaction_type") @db.Text // "like" or "pass"
  viewedAt        DateTime @default(now()) @map("viewed_at") @db.Timestamptz(6)

  viewer          User     @relation("ProfileViewer", fields: [viewerId], references: [userId], onDelete: Cascade)
  viewedProfile   User     @relation("ProfileViewed", fields: [viewedProfileId], references: [userId], onDelete: Cascade)

  @@index([viewerId])
  @@index([viewedProfileId])
  @@map("profile_views")
}
